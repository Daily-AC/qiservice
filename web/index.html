<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Service Station | æ§åˆ¶å°</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Add FontAwesome/Iconify if needed, using simple unicode/svg for now -->
</head>
<body>
    <div id="login_check" style="position:fixed;top:0;left:0;width:100%;height:100%;background:var(--bg-body);z-index:9999;display:flex;align-items:center;justify-content:center;">
        <div style="text-align:center; color:var(--text-muted);">æ­£åœ¨åŠ è½½...</div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="brand">
            <span>âš¡</span> æœåŠ¡ä¸­è½¬ç«™
        </div>
        
        <nav class="nav-group">
            <div class="nav-label">æ§åˆ¶å°</div>
            <a class="nav-item active" onclick="nav('dashboard')" id="nav-dashboard">
                <span>ğŸ“Š</span> æ¦‚è§ˆ
            </a>
            <a class="nav-item" onclick="nav('my-keys')" id="nav-keys">
                <span>ğŸ”‘</span> æˆ‘çš„å¯†é’¥
            </a>
            <a class="nav-item" onclick="nav('playground')" id="nav-playground">
                <span>ğŸ®</span> è°ƒè¯•æ²™ç®±
            </a>
            <a class="nav-item" onclick="nav('docs')" id="nav-docs">
                <span>ğŸ“š</span> ä½¿ç”¨æ–‡æ¡£
            </a>
        </nav>

        <!-- Admin Only -->
        <nav class="nav-group" id="admin-nav" style="display: none;">
            <div class="nav-label">ç®¡ç†é¢æ¿</div>
            <a class="nav-item" onclick="nav('users')" id="nav-users">
                <span>ğŸ‘¥</span> ç”¨æˆ·ç®¡ç†
            </a>
            <a class="nav-item" onclick="nav('services')" id="nav-services">
                <span>ğŸ”Œ</span> æœåŠ¡é…ç½®
            </a>
            <!-- <a class="nav-item" onclick="nav('system')"><span>âš™ï¸</span> ç³»ç»Ÿè®¾ç½®</a> -->
        </nav>

        <div class="user-profile">
            <div class="avatar" id="user-avatar">U</div>
            <div style="flex:1; overflow:hidden;">
                <div style="font-weight:600; text-overflow:ellipsis; overflow:hidden;" id="disp-username">User</div>
                <div style="font-size:0.75rem; color:var(--text-muted);" id="disp-role">Role</div>
            </div>
            <button class="btn btn-secondary btn-sm" onclick="logout()" title="é€€å‡ºç™»å½•">âœ</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        
        <!-- Dashboard (Service List & Stats Preview) -->
        <div id="page-dashboard" class="page active">
            <h2>æœåŠ¡æ¦‚è§ˆ</h2>
            
            <div class="grid" id="service-list">
                <!-- JS Injected -->
            </div>
        </div>

        <!-- My Keys -->
        <div id="page-my-keys" class="page">
        <!-- ... (unchanged) ... -->
        </div>

        <!-- Docs Page -->
        <div id="page-docs" class="page">
            <h2>ä½¿ç”¨æ–‡æ¡£ (Documentation)</h2>
            <div class="card">
                <h3>Base Configuration</h3>
                <p>æ— è®ºä½¿ç”¨å“ªç§å®¢æˆ·ç«¯ï¼ŒåŸºç¡€é…ç½®å¦‚ä¸‹ï¼š</p>
                <ul style="margin-left:1.5rem; line-height:1.8;">
                    <li><strong>API Endpoint (Base URL):</strong> <code>http://&lt;Server-IP&gt;:8080/v1</code></li>
                    <li><strong>API Key:</strong> ä½¿ç”¨æ‚¨çš„ API Key (å‰å¾€â€œæˆ‘çš„å¯†é’¥â€ç”Ÿæˆ)</li>
                </ul>
                <hr style="margin:1.5rem 0; border:0; border-top:1px solid var(--border-color);">
                
                <h3>ğŸ”¥ OpenAI / Compatible Clients</h3>
                <p>é€‚ç”¨äº Python `openai` åº“, LangChain, NextChat ç­‰ã€‚</p>
                <pre style="background:var(--bg-body); padding:1rem; border-radius:6px; overflow-x:auto;">
import openai

client = openai.OpenAI(
    base_url="http://localhost:8080/v1",
    api_key="sk-..."
)

resp = client.chat.completions.create(
    model="claude-3-5-sonnet", # å¡«å…¥æ§åˆ¶å°æ˜¾ç¤ºçš„â€œæœåŠ¡åç§°â€
    messages=[{"role": "user", "content": "Hello!"}]
)
print(resp.choices[0].message.content)</pre>
                
                <hr style="margin:1.5rem 0; border:0; border-top:1px solid var(--border-color);">

                <h3>ğŸ¤– Anthropic Claude Clients</h3>
                <p>é€‚ç”¨äºåŸç”Ÿ Claude SDK æˆ– claude-code å·¥å…·ã€‚</p>
                <div style="background:var(--nav-item-active-bg); padding:0.8rem; border-radius:4px; margin-bottom:1rem; border-left:4px solid var(--primary);">
                    æ³¨æ„ï¼šæœ¬æœåŠ¡å®Œå…¨å…¼å®¹ OpenAI æ ¼å¼ã€‚è™½ç„¶æ”¯æŒ Anthropic åè®®é€ä¼ ï¼Œä½†å»ºè®®å¤§å¤šæ•°å®¢æˆ·ç«¯ä½¿ç”¨ <strong>OpenAI å…¼å®¹æ¨¡å¼</strong> è¿æ¥ã€‚
                </div>

                <h4>Setup for <code>claude-code</code> (CLI)</h4>
                <p>åœ¨ç»ˆç«¯è®¾ç½®ç¯å¢ƒå˜é‡ä»¥ä»£ç†è¯·æ±‚ï¼š</p>
                
                <p><strong>Windows (PowerShell):</strong></p>
                <pre style="background:var(--bg-body); padding:1rem; border-radius:6px;">
$env:ANTHROPIC_BASE_URL="http://localhost:8080/v1"
$env:ANTHROPIC_API_KEY="sk-..."
claude</pre>

                <p><strong>Mac / Linux:</strong></p>
                <pre style="background:var(--bg-body); padding:1rem; border-radius:6px;">
export ANTHROPIC_BASE_URL="http://localhost:8080/v1"
export ANTHROPIC_API_KEY="sk-..."
claude</pre>
            </div>
        </div>
        <!-- ... -->
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
                <h2>æˆ‘çš„å¯†é’¥ (API Keys)</h2>
                <button class="btn btn-primary" onclick="generateMyKey()">+ æ–°å»ºå¯†é’¥</button>
            </div>
            <div class="card">
                <table class="data-table">
                    <thead><tr><th>åç§°</th><th>Key (éƒ¨åˆ†éšè—)</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>
                    <tbody id="my-keys-list"></tbody>
                </table>
            </div>
        </div>

        <!-- Playground -->
        <div id="page-playground" class="page">
            <h2>è°ƒè¯•æ²™ç®±</h2>
            <div class="card chat-container">
                <div style="border-bottom:1px solid var(--border-color); padding-bottom:1rem; margin-bottom:1rem; display:flex; gap:1rem;">
                    <select id="pg-model" class="form-select" style="max-width:200px;"></select>
                    <select id="pg-key" class="form-select" style="max-width:200px;"></select>
                </div>
                <div class="chat-messages" id="pg-messages">
                    <div class="chat-bubble chat-assistant">ä½ å¥½ï¼è¯·å…ˆé€‰æ‹©æ¨¡å‹å’Œå¯†é’¥ï¼Œç„¶åå¼€å§‹æµ‹è¯•ã€‚</div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="pg-input" class="form-input" placeholder="è¾“å…¥æ¶ˆæ¯..." onkeypress="if(event.key==='Enter') sendMsg()">
                    <button class="btn btn-primary" onclick="sendMsg()">å‘é€</button>
                </div>
            </div>
        </div>

        <!-- ADMIN: User Management -->
        <div id="page-users" class="page">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
                <h2>ç”¨æˆ·ç®¡ç†</h2>
                <button class="btn btn-primary" onclick="openCreateUserModal()">+ æ–°å¢ç”¨æˆ·</button>
            </div>
            <div class="card">
                <table class="data-table">
                    <thead><tr><th>ID</th><th>ç”¨æˆ·å</th><th>è§’è‰²</th><th>é…é¢ (Quota/Used)</th><th>æ“ä½œ</th></tr></thead>
                    <tbody id="user-list-body"></tbody>
                </table>
            </div>
        </div>

        <!-- ADMIN: Service Management -->
        <div id="page-services" class="page">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
                <h2>æœåŠ¡é…ç½®</h2>
                <button class="btn btn-primary" onclick="openServiceModal()">+ æ·»åŠ ä¸Šæ¸¸æœåŠ¡</button>
            </div>
            <div class="grid" id="admin-service-list">
                <!-- JS Injected (Admin View) -->
            </div>
        </div>

    </main>

    <!-- Modals -->
    
    <!-- Create Key Modal -->
    <div class="modal-overlay" id="modal-key">
        <div class="modal">
            <h3>æ–°å»º API Key</h3>
            <div class="form-group">
                <label class="form-label">å¤‡æ³¨åç§°</label>
                <input type="text" id="key-name-input" class="form-input" placeholder="ä¾‹å¦‚: Cursor Projects">
            </div>
            <div style="text-align:right; margin-top:1.5rem;">
                <button class="btn btn-secondary" onclick="closeModal('modal-key')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitNewMyKey()">åˆ›å»º</button>
            </div>
        </div>
    </div>

    <!-- Create User Modal -->
    <div class="modal-overlay" id="modal-user">
        <div class="modal">
            <h3>åˆ›å»ºæ–°ç”¨æˆ·</h3>
            <div class="form-group">
                <label class="form-label">ç”¨æˆ·å</label>
                <input type="text" id="cu-username" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">å¯†ç </label>
                <input type="text" id="cu-password" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">è§’è‰²</label>
                <select id="cu-role" class="form-select">
                    <option value="user">æ™®é€šç”¨æˆ· (User)</option>
                    <option value="admin">ç®¡ç†å‘˜ (Admin)</option>
                </select>
                <p style="font-size:0.8rem; color:var(--text-muted); margin-top:0.5rem;" id="cu-role-hint">æ³¨æ„ï¼šä»…è¶…ç®¡å¯åˆ›å»ºç®¡ç†å‘˜ã€‚</p>
            </div>
            <div class="form-group">
                <label class="form-label">é…é¢</label>
                <input type="number" id="cu-quota" class="form-input" value="100000">
            </div>
            <div style="text-align:right; margin-top:1.5rem;">
                <button class="btn btn-secondary" onclick="closeModal('modal-user')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitCreateUser()">åˆ›å»º</button>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal-overlay" id="modal-edit-user">
        <div class="modal">
            <h3>ç¼–è¾‘ç”¨æˆ·</h3>
            <input type="hidden" id="eu-id">
            <div class="form-group">
                <label class="form-label">ç”¨æˆ·å</label>
                <input type="text" id="eu-username" class="form-input" disabled>
            </div>
            <div class="form-group">
                <label class="form-label">è§’è‰² (ä»…è¶…ç®¡å¯æ”¹)</label>
                <select id="eu-role" class="form-select" disabled>
                     <option value="user">æ™®é€šç”¨æˆ·</option>
                     <option value="admin">ç®¡ç†å‘˜</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">ä¿®æ”¹å¯†ç  (ç•™ç©ºä¸ä¿®æ”¹)</label>
                <input type="text" id="eu-password" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">è°ƒæ•´é…é¢</label>
                <input type="number" id="eu-quota" class="form-input">
            </div>
             <div style="text-align:right; margin-top:1.5rem;">
                <button class="btn btn-secondary" onclick="closeModal('modal-edit-user')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitEditUser()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- Service Modal -->
    <div class="modal-overlay" id="modal-service">
        <div class="modal">
            <h3 id="ms-title">æœåŠ¡é…ç½®</h3>
            <input type="hidden" id="ms-id">

            <div class="form-group">
                <label class="form-label">æœåŠ¡åç§° (Model Name)</label>
                <input type="text" id="ms-name" class="form-input" placeholder="å®¢æˆ·ç«¯è¯·æ±‚æ—¶ä½¿ç”¨çš„æ¨¡å‹å">
            </div>
             <div class="form-group">
                <label class="form-label">æœåŠ¡å•†</label>
                <select id="ms-type" class="form-select">
                    <option value="openai">OpenAI / Compatible</option>
                    <option value="anthropic">Anthropic Claude</option>
                    <option value="gemini">Google Gemini</option>
                </select>
            </div>
             <div class="form-group">
                <label class="form-label">Base URL</label>
                <input type="text" id="ms-url" class="form-input" placeholder="ç•™ç©ºåˆ™ä½¿ç”¨å®˜æ–¹é»˜è®¤">
            </div>
             <div class="form-group">
                <label class="form-label">æ˜ å°„æ¨¡å‹ (Override)</label>
                <input type="text" id="ms-map" class="form-input" placeholder="å®é™…è½¬å‘ç»™ä¸Šæ¸¸çš„æ¨¡å‹å (å¯é€‰)">
            </div>
             <div class="form-group">
                <label class="form-label">API Key æ± </label>
                <div style="display:flex; gap:0.5rem; margin-bottom:0.5rem;">
                    <input type="text" id="ms-new-key" class="form-input" placeholder="è¾“å…¥ API Key (sk-...)">
                    <button class="btn btn-secondary" onclick="addServiceKey()">+</button>
                </div>
                <div id="ms-keys-list" style="max-height:150px; overflow-y:auto; border:1px solid var(--border-color); border-radius:6px; padding:0.5rem;">
                    <!-- Keys will be rendered here -->
                </div>
            </div>
            <div style="text-align:right; margin-top:1.5rem;">
                <button class="btn btn-secondary" onclick="closeModal('modal-service')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitService()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script src="app.js?v=4.0"></script>
</body>
</html>
